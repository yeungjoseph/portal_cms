<!DOCTYPE html>
<html>
	<head>
		<title>Admin Dashboard</title>
		<link rel="stylesheet" type="text/css" href="/stylesheets/main.css"/>
		<link rel="stylesheet" type="text/css" href="/stylesheets/admin.css"/>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	</head>
	<body>
		<header>Admin Dashboard</header>
		<% include admin-header %>
		
		<div class="content bg">
			<table id="dash">
				<caption>Table of Pages</caption>
				<% if(pages.length) { %>
					<tr>
						<th>Title</th>
						<th>Last Updated</th>
						<th>Options</th>
					</tr>
					<% for (var i = 0; i < pages.length; i++) {%>
						<tr>
							<td><a href="/<%= pages[i].url %>"</a>
								<%= pages[i].title %></a></td>
							<td>January 7, 2018</td>
							<td>
								<button class="btn-delete" data-page-id="<%= pages[i]._id %>">Delete</button>
								<form method="GET" class='within'>
									<input type='submit' value='Edit' id="btn-edit" formaction='/admin/page/edit/<%= pages[i]._id %>' />
								</form>	
								<% if(pages[i].visible) { %>
								<button class="btn-visibility" data-page-id="<%= pages[i]._id %>">Visible</button>
								<% }else { %>
								<button class="btn-visibility invisible" data-page-id="<%= pages[i]._id %>">Visible</button>
								<% } %>
							</td>
						</tr>
					<% } %>

				<% }else { %>
					<tr><td>No pages have been created yet!</td></tr>
				<% } %>
			</table>

			<!-- Add page form -->
			<div class="addpage">
				<h1>Add Pages</h1> <hr>
				<% if(typeof urlErr !== 'undefined') { %>
					<h4 class="auth-error"><%= urlErr %></h4>
				<% } %>
				<form id="add-form" method="POST">
				<!-- Title -->
					<label class="prettylabel">Title:</label> <br/>
					<input type="text" name="title" placeholder="Title of Page" required/> <br/>
				<!-- Content -->
					<label class="prettylabel">Content:</label> <br/>
					<textarea name="content" rows="10" cols="50"></textarea> <br/>
				<!-- URL -->
					<label class="prettylabel">URL:</label> <br/>
					<input type="text" name="URL" placeholder="URL of page"/> <br/>
				<!-- Template -->
					<label class="prettylabel">Template:</label> <br/>
					<select name="template" required>
						<option value="t1">Template 1</option>
						<option value="t2">Template 2</option>
						<option value="t3">Template 3</option>
					</select> <br/>
				<!-- Clear/Save -->
					<input type="reset" value="Clear"/>
					<input type="submit" value="Save" class="btn-add"/>
				</form>
			</div>
		</div>
		<% include footer %>
	</body>

	<script>
	$(function() {
		$('.btn-delete').on('click', function(e) {
			var button = $(this);
			var pageID = $(this).attr('data-page-id');
			$.ajax({
				method: 'DELETE',
				url: `/admin/page/${pageID}`
			})
			.done(function(response) {
				button.parent().parent().remove();
			});
			e.preventDefault();
		});
		$('.btn-visibility').on('click', function(e) {
			var button = $(this);
			var pageID = $(this).attr('data-page-id');
			$.ajax({
				method: 'POST',
				url: `/admin/page/visibility/${pageID}`,
			})
			.done(function() {
				button.toggleClass("invisible");
			});
			e.preventDefault();
		});
		$('#add-form').submit(function(e) {
			var formData = {
				title		: $('input[name=title]').val(),
				content		: $('textarea[name=content]').val(),
				url			: $('input[name=URL]').val(),
				template	: $('select[name=template]').val(),
			};
			$.ajax({
				method:	'POST',
				url:	'/admin/addpage/',
				data:	formData,
				success: function(data) {
					// Show the new page in the dashboard
				},
				error: function(xhr, status, err) {
					// Show an error message
					console.log(err);
				},
			})
			e.preventDefault();
		}); 
	});
	</script>
</html>
